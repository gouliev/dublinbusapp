CREATE DEFINER=`oscar`@`localhost` PROCEDURE `trip_leavetimes_join`(in line varchar(5), in dir int)
begin
select t.dayofservice, t.tripid, lineid, direction, progrnumber, stoppointid, 
t.plannedarr as tripPlannedArr, t.planneddep as tripPlannedDep,
t.actualarr as tripActualArr, t.actualdep as tripActualDep, 
l.plannedarr as stopPlannedArr, l.planneddep as stopPlannedDep,
l.actualarr as stopActualArr, l.actualdep as stopActualDep, 
vehicleid
FROM trips t
left join leavetimes l
on t.tripid = l.tripid
and t.dayofservice = l.dayofservice
WHERE lineid = line
AND direction = dir
AND l.stoppointid is not null;
end